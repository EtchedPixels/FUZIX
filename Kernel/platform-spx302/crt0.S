/*
 *	Need to wipe BSS etc once we figure out our preferred boot method
 *
 *	On entry we are loaded at $0400 from a loader somewhere above us
 *	The entry is made with interrupts off in supervisor mode. No valid
 *	stack can be assumed. CP/M 68K is no longer alive.
 */
		#include "../kernel-68000.def"

		.globl __end
		.globl __bss_start

.mri 1
		word $0302
start:
		or #$0700,sr
		move.l #__bss_start,a0
		move.l #__end,d0
		sub.l a0,d0
		lsr.l #2,d0
wipebss:
		clr.l (a0)+
		dbra d0,wipebss

		lea udata_block0+UBLOCK_SIZE,a7
		bsr init_early
		bsr init_hardware
		bsr fuzix_main
		or #$0700,sr
stop:		bra stop
